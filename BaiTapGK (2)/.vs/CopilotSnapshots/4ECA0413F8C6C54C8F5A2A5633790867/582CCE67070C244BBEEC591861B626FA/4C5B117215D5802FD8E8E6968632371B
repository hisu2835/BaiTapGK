using System;
using System.Drawing;
using System.Windows.Forms;

namespace BaiTapGK
{
    public partial class Form1 : FullscreenSupportForm
    {
        private string playerName = "";
        private bool isLoggedIn = false;

        public Form1()
        {
            InitializeComponent();
            this.StartPosition = FormStartPosition.CenterScreen;
            this.FormBorderStyle = FormBorderStyle.Sizable; // Cho phep resize
            this.MaximizeBox = true; // Cho phep maximize
            this.MinimizeBox = true; // Cho phep minimize
            
            // Set minimum size
            this.MinimumSize = new Size(600, 400);
        }

        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);
            // Hien thi form dang nhap khi form load
            ShowLoginForm();
        }

        private void ShowLoginForm()
        {
            LoginForm loginForm = new LoginForm();
            if (loginForm.ShowDialog() == DialogResult.OK)
            {
                playerName = loginForm.PlayerName;
                isLoggedIn = true;
                if (lblWelcome != null)
                    lblWelcome.Text = $"Chao mung, {playerName}!";
                EnableGameButtons(true);
            }
            else
            {
                // Neu nguoi dung huy dang nhap, dong ung dung
                Application.Exit();
            }
        }

        private void EnableGameButtons(bool enabled)
        {
            if (btnSinglePlayer != null)
                btnSinglePlayer.Enabled = enabled;
            if (btnMultiPlayer != null)
                btnMultiPlayer.Enabled = enabled;
            if (btnGameIntro != null)
                btnGameIntro.Enabled = enabled;
        }

        private void btnSinglePlayer_Click(object sender, EventArgs e)
        {
            if (!isLoggedIn)
            {
                MessageBox.Show("Vui long dang nhap truoc!", "Thong bao", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return;
            }

            SinglePlayerForm singlePlayerForm = new SinglePlayerForm(playerName);
            singlePlayerForm.ShowDialog();
        }

        private void btnMultiPlayer_Click(object sender, EventArgs e)
        {
            if (!isLoggedIn)
            {
                MessageBox.Show("Vui long dang nhap truoc!", "Thong bao", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return;
            }

            MultiPlayerForm multiPlayerForm = new MultiPlayerForm(playerName);
            multiPlayerForm.ShowDialog();
        }

        private void btnGameIntro_Click(object sender, EventArgs e)
        {
            GameIntroForm gameIntroForm = new GameIntroForm();
            gameIntroForm.ShowDialog();
        }

        private void btnExit_Click(object sender, EventArgs e)
        {
            Application.Exit();
        }

        private void btnChangeUser_Click(object sender, EventArgs e)
        {
            isLoggedIn = false;
            EnableGameButtons(false);
            ShowLoginForm();
        }

        protected override void AdjustLayoutForFullscreen(bool isFullscreen)
        {
            // Dieu chinh layout cua menu chinh khi fullscreen
            if (isFullscreen)
            {
                // Fullscreen mode - make elements bigger and more spaced
                AdjustControlsForFullscreen(true);
            }
            else
            {
                // Windowed mode - return to normal size
                AdjustControlsForFullscreen(false);
            }
        }

        private void AdjustControlsForFullscreen(bool isFullscreen)
        {
            // Calculate scale factor based on screen size
            float scaleFactor = isFullscreen ? 1.5f : 1.0f;
            
            // Adjust font sizes
            if (lblWelcome != null)
            {
                lblWelcome.Font = new Font(lblWelcome.Font.FontFamily, 
                    lblWelcome.Font.Size * scaleFactor, lblWelcome.Font.Style);
            }
            
            // Adjust button sizes
            AdjustButtonForFullscreen(btnSinglePlayer, scaleFactor);
            AdjustButtonForFullscreen(btnMultiPlayer, scaleFactor);
            AdjustButtonForFullscreen(btnGameIntro, scaleFactor);
            AdjustButtonForFullscreen(btnChangeUser, scaleFactor);
            AdjustButtonForFullscreen(btnExit, scaleFactor);
            
            // Re-center controls if needed
            CenterControlsOnForm();
        }

        private void AdjustButtonForFullscreen(Button? button, float scaleFactor)
        {
            if (button == null) return;
            
            // Store original size in Tag if not already stored
            if (button.Tag == null)
            {
                button.Tag = new Size(button.Width, button.Height);
            }
            
            Size originalSize = (Size)button.Tag;
            button.Size = new Size(
                (int)(originalSize.Width * scaleFactor),
                (int)(originalSize.Height * scaleFactor)
            );
            
            // Adjust font
            if (scaleFactor != 1.0f)
            {
                button.Font = new Font(button.Font.FontFamily, 
                    button.Font.Size * scaleFactor, button.Font.Style);
            }
        }

        private void CenterControlsOnForm()
        {
            // Re-arrange controls to be centered
            // This would need to be customized based on your specific layout
            foreach (Control control in this.Controls)
            {
                if (control is Button || control is Label)
                {
                    // Simple centering logic - adjust based on your needs
                    control.Left = (this.ClientSize.Width - control.Width) / 2;
                }
            }
        }
    }
}
